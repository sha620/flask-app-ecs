pipeline{
    agent any;
    stages{
        stage("clone"){
          steps{
              git url: "https://github.com/sha620/flask-app-ecs.git",branch:"main"
          }  
        }
        stage("buil"){
         steps{
             sh "docker build -f ./Dockerfile-multi -t multi:la ."
         }   
        }
        stage("test"){
            steps{
            echo "test"    
            }
        }
        stage("push to dokerhub"){
            steps{
            withCredentials([usernamePassword(
            credentialsId:"Dockerhubcred",
            usernameVariable:"user",
            passwordVariable:"pass"
                )]){
            sh "docker login -u ${env.user} -p ${env.pass}"
            sh "docker image tag multi:la ${env.user}/multi:la"
            sh "docker push ${env.user}/multi:la"
                }
            }
            
        }
        stage("deploy"){
            steps{
                sh "docker run -d -p 80:80  multi:la"
            }
            
        }
    }
}
